{"pages":[],"posts":[{"title":"ProxmoxにOSXを入れる夢を見た","text":"ProxmoxにOSXのVMを入れる夢を見たので忘れないうちに残しておきます。 環境サーバ環境proxmox-ve 6.4-1Ryzen 7 pro 4750G メモリ32GB NFSストレージ OS:BigSur11 ブートローダー:OpenCore-v13 VM作成時の設定OSOSのisoイメージ:OpenCore システムグラフィックカード:VMWare 互換Qemu agent:onBIOS:UEFIマシン:q35EFI Disk:onStorage:ハードディスクに使うものと同じ形式:Raw ハードディスクデバイス:VirtIO Block形式:RawCache:Write BackDiscard:on CPUCore:2n(n:自然数)NUMA:on MemoryMemory size:1024n(n:自然数)Ballooning Device:off NetworkModel:VMware vmxnet3 VM作成後、オプションのポインタ用にタブレットを使うを「はい」になっていることを確認。ハードウェアからBigSur11.isoをIDEでマウント VM.confの設定変更 /etc/pve/qemu-server/“VMID”.conf をnanoで編集します。 先頭行に以下を追加 args: -device isa-applesmc,osk=”OSKキー(調べたり発行したりお好きにどうぞ)” -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 ‘CPUの設定(以下参照)’ ↓Intel系CPU-cpu host,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc ↓AMD系CPU-cpu Penryn,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc,+pcid,+ssse3,+sse4.2,+popcnt,+avx,+avx2,+aes,+fma,+fma4,+bmi1,+bmi2,+xsave,+xsaveopt,check マウントしてるisoファイルの設定からmedia=chromを削除し、cache=unsafeを追加 保存し終了。 consoleから 1echo &quot;options kvm ignore_msrs=Y&quot; &gt;&gt; /etc/modprobe.d/kvm.conf &amp;&amp; update-initramfs -k all -u を送り終了するまで待ちます。 以上で設定終了です。 osxの起動 設定が完了したらVMを起動したら、OpenCoreが起動するので一番左のmacOS Base Systemに十字キーで選びEnter(キー操作はできません) 以下のような画像になるのでDisk UtilityからマウントしているDiskをAPFSでフォーマットします。 フォーマットが完了したらInstall macOS BigSurから適当にインストールします。 インストールが終了するとOpenCorにInstall macOS(名称が他環境で一緒かはわからない)が出てくるので選ぶ私の場合は何回か再起動したのちに初期セットアップ画面が出てきました。 適当にインストールして、おわりです。 私の環境ではiMac Proで認識(?)していました。 参考資料 https://zenn.dev/northeggman/articles/9a841385f10315https://www.youtube.com/watch?v=220i9xW1WJI","link":"/2021/07/27/Proxmox%E3%81%ABOSX%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B%E5%A4%A2%E3%82%92%E8%A6%8B%E3%81%9F/"},{"title":"TrueNASが壊れた","text":"TrueNASのRaidZ2が壊れてサーバーのデータ全部飛んだ オワリ readonly, -m でimportは出来るがマウントが上手くいかない・・・-mだけだとimport中に再起動。おそらくキャッシュに使用しているssdが原因っぽいけれどうーんわからん・・・・ とりあえずサーバーの内蔵ディスクでブログのみ復旧 windowsで使ってるSMBのディスクは生きていたが、そっちが壊れる分には別に・・・って気持ち","link":"/2021/10/13/RaidZ2%E3%81%8C%E5%A3%8A%E3%82%8C%E3%81%9F/"},{"title":"UbuntuでのApache自動起動","text":"再起動時にApacheが起動しなく、原因はsslの認証でした。 設定ファイル作成 1# sudo vim /etc/ssl/certs/pass_ssl.sh 書き込み 12#!/bin/shecho 'パスフレーズ' 権限変更 1# sudo chmod 500 /etc/ssl/certs/pass_ssl.sh apache設定ファイルに追記 1# vi /etc/apache2/apache2.conf 1SSLPassPhraseDialog exec:/etc/ssl/certs/pass_ssl.sh &lt;-これ apache再起動 12# systemctl restart apache2# パスフレーズの入力を求められることなく無事に起動できました。","link":"/2021/05/03/Ubuntu%E3%81%A7%E3%81%AEApache%E8%87%AA%E5%8B%95%E8%B5%B7%E5%8B%95/"},{"title":"hexo generateとアップロードの自動化","text":"毎回powershellからhexo generateをしてサーバ(ネットワークドライブ)にアップロードするのが面倒くさいので、起動するとgenerateとアップロードをしてくれるようにプログラミングをしました。 1234567891011121314151617181920212223242526272829303132333435363738394041424344using System;using System.Collections.Generic;using System.Linq;using System.Text;using System.Threading.Tasks;using System.IO;using System.Diagnostics;namespace Hexo_sync{ class Program { static void Main(string[] args) { System.Diagnostics.Process HexoProcess = new System.Diagnostics.Process(); string Cmd = &quot;hexo &quot; + &quot;'generate'&quot;; ProcessStartInfo HexoProcessInfo = new ProcessStartInfo(&quot;powershell.exe&quot;, Cmd); HexoProcessInfo.CreateNoWindow = true; HexoProcessInfo.WorkingDirectory = @&quot;D:\\OneDrive - ****\\blog&quot;; HexoProcessInfo.WindowStyle = ProcessWindowStyle.Hidden; HexoProcess = System.Diagnostics.Process.Start(HexoProcessInfo); HexoProcess.WaitForExit(); HexoProcess.Close(); string LocalPath = @&quot;D:\\OneDrive - ****\\blog\\public&quot;; string NetworkPath = @&quot;J:\\scepter&quot;; string[] Files = Directory.GetFiles(LocalPath, &quot;*&quot;, SearchOption.AllDirectories); Parallel.ForEach(Files, File =&gt; { if(!Directory.Exists(Path.GetDirectoryName(NetworkPath + File.Replace(LocalPath, &quot;&quot;)))) { string dir = Path.GetDirectoryName(NetworkPath + File.Replace(LocalPath, &quot;&quot;)); Directory.CreateDirectory(dir); } System.IO.File.Copy(File, NetworkPath + File.Replace(LocalPath, &quot;&quot;), true); } ); Environment.Exit(0); } }} 詰まった所hexo generateとすると引数が認識されない色々試した結果”hexo” + “‘generate’”になりました。 更新して気付いたけどまた中国語みたいなフォントになってる・・・","link":"/2021/05/05/hexo-generate%E3%81%AE%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%A8%E5%90%8C%E6%9C%9F%E5%8C%96/"},{"title":"npmのダウングレード","text":"hexo generateをすると以下のようなエラーが出たので原因を調べるとnpmのバージョンが原因だと判明。 1234567891011121314151617181920212223242526272829&gt; hexo generateINFO Validating configInferno is in development mode.INFO ======================================= ██╗ ██████╗ █████╗ ██████╗ ██╗ ██╗███████╗ ██║██╔════╝██╔══██╗██╔══██╗██║ ██║██╔════╝ ██║██║ ███████║██████╔╝██║ ██║███████╗ ██║██║ ██╔══██║██╔══██╗██║ ██║╚════██║ ██║╚██████╗██║ ██║██║ ██║╚██████╔╝███████║ ╚═╝ ╚═════╝╚═╝ ╚═╝╚═╝ ╚═╝ ╚═════╝ ╚══════╝=============================================INFO === Checking package dependencies ===INFO === Checking theme configurations ===INFO === Registering Hexo extensions ===INFO Start processingINFO Files loaded in 782 msINFO Deleted: img/favicon.ico(node:8680) Warning: Accessing non-existent property 'lineno' of module exports inside circular dependency(Use `node --trace-warnings ...` to show where the warning was created)(node:8680) Warning: Accessing non-existent property 'column' of module exports inside circular dependency(node:8680) Warning: Accessing non-existent property 'filename' of module exports inside circular dependency(node:8680) Warning: Accessing non-existent property 'lineno' of module exports inside circular dependency(node:8680) Warning: Accessing non-existent property 'column' of module exports inside circular dependency(node:8680) Warning: Accessing non-existent property 'filename' of module exports inside circular dependencyINFO Generated: img/avatar.pngINFO Generated: img/og_image.pngINFO Generated: css/cyberpunk.cssINFO 3 files generated in 1.94 s なのでhttps://nodejs.org/ja/download/releases/からバージョンを調べてダウングレード。 12345&gt; npm install -g npm@6.14.12C:\\Users\\****\\AppData\\Roaming\\npm\\npx -&gt; C:\\Users\\****\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.jsC:\\Users\\****\\AppData\\Roaming\\npm\\npm -&gt; C:\\Users\\****\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js+ npm@6.14.12 バージョンの確認 123&gt; node -vv14.16.1 hexo generateしてみる 123456789101112131415161718&gt; hexo generateINFO Validating configInferno is in development mode.INFO ======================================= ██╗ ██████╗ █████╗ ██████╗ ██╗ ██╗███████╗ ██║██╔════╝██╔══██╗██╔══██╗██║ ██║██╔════╝ ██║██║ ███████║██████╔╝██║ ██║███████╗ ██║██║ ██╔══██║██╔══██╗██║ ██║╚════██║ ██║╚██████╗██║ ██║██║ ██║╚██████╔╝███████║ ╚═╝ ╚═════╝╚═╝ ╚═╝╚═╝ ╚═╝ ╚═════╝ ╚══════╝=============================================INFO === Checking package dependencies ===INFO === Checking theme configurations ===INFO === Registering Hexo extensions ===INFO Start processingINFO Files loaded in 781 msINFO 0 files generated in 233 ms エラーが出なくなりました。","link":"/2021/05/04/npm%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89/"},{"title":"グループ面接のはなし","text":"グループ面接の話です。 今日グループ面接(就活生:面接官=2:1)でした。私は面接の際にとても緊張してしまい場数を踏んで少しはマシになっていたのですが、最近面接していなかったせいでガチガチに緊張してしまいました。面接中にzoom退出したくなるほどでしたね。ズレてるどころかゴミみたいな回答してたし、もう一人の就活生はすっげーペラペラ話してるし消えたくなりましたね。面接官に申し訳ない。はーしんど 研究やべえし。面接キライ。","link":"/2021/06/17/%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E9%9D%A2%E6%8E%A5%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%97/"},{"title":"自宅サーバの構成紹介","text":"色々とおちついたので、自宅サーバの構成を書き留めておきます。 自宅サーバの構成はこのようになっています。こういった図は書いたことが無いので見よう見真似です。 ルーターはRTX1200を使用して、スイッチにはGS 908XLを使用しています。 サーバとしては3台使用していて、NAS1,仮想化基盤2の構成です。 NASOS:TrueNASCPU:core i5 2320メモリ:14GBboot:HDD 160Gの構成で500GBのHDD5台とSSDcache1台でRaidZ2構成にしています。基本的にこのraidでproxmoxにデータを割り振っています。あとはデータ保存用の6TBのHDD*1です。 この構成を組んだ時に使用していた電源がしょぼすぎてOSがフリーズしまくってたのですが電源変えてからは特に異常等は無いですね。電源重要。現状そこそこ満足してますが、やはり10GBpsの環境にして遅延をできるだけ無くしたいなーって思ったり。 Proxmox 1号機OS:Proxmox VECPU:core i7 6700Kメモリ:16GBboot:SSD 120GB通称ゴミ箱PC。フリマサイトで↑の構成がメモリ8GBだったものが2万円で出品されていて格安だと思って購入しました。しかしあまりにもヤニ汚れがひどく半日ぐらいかけて掃除しましたね・・・ あと電源がKEIAN製だからファンがうるさかったのでバラして12mmファンを無理やり付けました。温度も音も大丈夫そうです。 起動しているのはapache*3とnginx*1とUbuntu Desktopですね。nginxはリバースプロキシとして使用しています。 Proxmox 2号機OS:Proxmox VECPU:Ryzen 7 pro 4750Gメモリ:32GBboot:SSD 120GB 話題になってた(?)lenovo thinkcentreシリーズで、楽天リーベイツで買うと４万円台で買うことが出来るm75s small gen2です。8コア16スレッドはすぎょい。メインPCがRyzen 5 2600なのでメインより強い。まあメモリ買い足したので+13000円ぐらいで合計6万ぐらい？余ってる8GBは1号機に分けました。起動しているのはWindows10 Edu *1とBigSur *1です。Windowsに11スレッド割り当てているけどCore i7 8700ぐらいの性能があります。強すぎ。","link":"/2021/07/31/%E8%87%AA%E5%AE%85%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE%E6%A7%8B%E6%88%90%E7%B4%B9%E4%BB%8B/"},{"title":"炎上案件","text":"炎上案件(雑誌会)になりそうでしたがギリギリで回避できました。 9月上旬に雑誌会があるので発表する論文をそろそろ決める必要があったのですが、来週から夏休みが始まるのを完全に忘れてて危うく大炎上するところでした。発表予定の論文を先輩に見てもらった感じ大丈夫そうなので休み中に読み込んでパワポ作成ですね・・・ 全然落ち着けねー！！","link":"/2021/08/07/%E7%82%8E%E4%B8%8A%E6%A1%88%E4%BB%B6/"}],"tags":[{"name":"Proxmox","slug":"Proxmox","link":"/tags/Proxmox/"},{"name":"OSX","slug":"OSX","link":"/tags/OSX/"},{"name":"Apache","slug":"Apache","link":"/tags/Apache/"},{"name":"Ubuntu","slug":"Ubuntu","link":"/tags/Ubuntu/"},{"name":"Hexo","slug":"Hexo","link":"/tags/Hexo/"},{"name":"C#","slug":"C","link":"/tags/C/"},{"name":"就活","slug":"就活","link":"/tags/%E5%B0%B1%E6%B4%BB/"},{"name":"研究","slug":"研究","link":"/tags/%E7%A0%94%E7%A9%B6/"}],"categories":[{"name":"Server","slug":"Server","link":"/categories/Server/"},{"name":"Program","slug":"Program","link":"/categories/Program/"}]}